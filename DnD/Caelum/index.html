<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caelum - Pulp Cthulhu Character Sheet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Old Standard TT (for titles) and Roboto Condensed (for body) -->
    <link href="https://fonts.googleapis.com/css2?family=Old+Standard+TT:wght@400;700&family=Roboto+Condensed:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: #2c2f33; /* Dark background */
            color: #e0e0e0; /* Light grey text */
            line-height: 1.4; /* Reduced line height */
            /* Steampunk background: gears with orange tint */
            background-image: 
                linear-gradient(rgba(255, 140, 0, 0.2), rgba(255, 140, 0, 0.2)), /* Orange overlay */
                url('images/gears.jpg'); /* Placeholder for gear pattern */
            background-size: auto; /* Cover the entire body */
            background-repeat: repeat; /* Repeat the gear pattern */
            background-attachment: fixed;
            background-position: center center; /* Center the background */
        }
        .container {
            max-width: 960px; /* Slightly reduced max-width */
            margin: 1rem auto; /* Reduced top/bottom margin */
            padding: 1rem; /* Reduced padding */
            background-color: #3a3f44; /* Slightly lighter dark background for content */
            border-radius: 10px; /* Slightly smaller border-radius */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4); /* Slightly smaller shadow */
            border: 1px solid #5a5f66; /* Subtle border */
        }
        h1, h2, h3 {
            font-family: 'Old Standard TT', serif; /* Epic/Medieval font for headings */
            font-weight: 700;
            color: #f7d750; /* Brass/gold color for headings */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); /* Slightly smaller shadow */
        }
        h1 {
            font-size: 2.2rem; /* Smaller */
            text-align: center;
            margin-bottom: 1rem; /* Reduced margin */
            text-transform: uppercase;
            letter-spacing: 1.5px; /* Slightly reduced letter spacing */
            border-bottom: 2px double #f7d750; /* Smaller double line border */
            padding-bottom: 0.6rem; /* Reduced padding */
        }
        h2 {
            font-size: 1.6rem; /* Smaller */
            border-bottom: 1px solid #6b7280; /* Thinner border */
            padding-bottom: 0.4rem; /* Reduced padding */
            margin-top: 1.5rem; /* Consistent margin-top for all main section headings */
            margin-bottom: 0.8rem; /* Reduced margin */
            color: #c0c0c0; /* Silver-like color */
        }
        h3 {
            font-size: 1.2rem; /* Smaller */
            margin-top: 1rem; /* Reduced margin */
            margin-bottom: 0.5rem; /* Reduced margin */
            color: #d0d0d0;
        }

        /* Input & Section Styling */
        .stat-grid, .grid-cols-1.md\:grid-cols-2, .grid-cols-1.md\:grid-cols-3 {
            gap: 0.75rem; /* Reduced gap for more compact layout */
        }
        /* New class for consistent bottom margin on major content blocks */
        .section-block {
            margin-bottom: 1.5rem; /* Consistent spacing between major sections */
        }

        .p-4.bg-gray-50.rounded-lg.border.border-gray-200,
        .stat-item, .skill-item, .combat-item, .section-content {
            background-color: #4a4f54; /* Darker panel background */
            padding: 0.8rem; /* Reduced padding */
            border-radius: 8px; /* Slightly smaller border-radius */
            border: 1px solid #6b7280; /* Subtle border */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3); /* Inner shadow for depth */
        }
        label {
            font-weight: 600;
            margin-bottom: 0.3rem; /* Reduced margin */
            color: #f7d750; /* Brass/gold for labels */
            text-transform: uppercase;
            font-size: 0.8rem; /* Smaller font */
            letter-spacing: 0.5px;
        }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 0.4rem; /* Reduced padding */
            border: 1px solid #6b7280;
            border-radius: 5px; /* Smaller border-radius */
            font-size: 0.9rem; /* Smaller font */
            background-color: #3a3f44; /* Dark input background */
            color: #e0e0e0; /* Light text in inputs */
            box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.2); /* Smaller shadow */
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus, textarea:focus {
            border-color: #f7d750; /* Gold border on focus */
            box-shadow: 0 0 0 1px rgba(247, 215, 80, 0.5); /* Smaller gold glow on focus */
            outline: none;
        }
        textarea {
            min-height: 60px; /* Reduced min-height */
            resize: vertical;
        }
        .stat-item input[type="number"] {
            text-align: center;
            font-size: 1rem; /* Smaller font */
            font-weight: 700;
            color: #f7d750; /* Gold for stat values */
            /* Specific width to fit 3 numbers */
            width: 60px; /* Adjust as needed based on font and padding */
            margin: 0 auto; /* Center the input */
        }
        .text-xs.text-gray-500 {
            color: #b0b0b0; /* Lighter grey for derived stats */
            font-size: 0.7rem; /* Even smaller font */
            margin-top: 0.3rem; /* Reduced margin */
        }
        /* Skill Grid Specific Styles */
        .skill-grid {
            display: grid; /* Ensure it's a grid */
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); /* Increased min-width for skill names */
            gap: 0.5rem; /* Further reduced gap for skills */
            /* margin-top: 0.8rem; Removed as section-block handles overall spacing */
        }
        .skill-item {
            background-color: #4a4f54;
            padding: 0.6rem; /* Reduced padding */
            border-radius: 8px;
            border: 1px solid #6b7280;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            display: flex; /* Keep flex for internal alignment */
            flex-direction: column;
            justify-content: space-between;
        }
        .skill-item label {
            font-size: 0.75rem; /* Even smaller font for skill names */
            margin-bottom: 0.2rem; /* Reduced margin */
            white-space: normal; /* ALLOW TEXT WRAPPING */
            overflow: visible; /* ALLOW OVERFLOW */
            text-overflow: clip; /* PREVENT ELLIPSIS */
            line-height: 1.1; /* Tighter line height for multi-line labels */
        }
        .skill-item .skill-value-group {
            display: flex;
            gap: 0.25rem; /* Smaller gap */
            align-items: center;
        }
        .skill-item .skill-value-group input {
            flex-grow: 1;
            max-width: 45px; /* Even narrower input */
            padding: 0.2rem; /* Even less padding */
            font-size: 0.8rem; /* Even smaller font for value */
        }
        .skill-item .skill-value-group span {
            color: #f7d750; /* Gold for percentage sign */
            font-weight: 700;
            font-size: 0.75rem; /* Smaller font */
        }
        .checkbox-group {
            margin-top: 0.2rem; /* Reduced margin */
        }
        .checkbox-group span {
            color: #e0e0e0;
            font-size: 0.7rem; /* Even smaller font for 'Trained' */
        }
        input[type="checkbox"] {
            accent-color: #f7d750; /* Gold checkbox */
            transform: scale(1); /* Reset scale */
            margin-right: 0.3rem; /* Reduced margin */
        }

        /* Resource Bars */
        .resource-bar {
            background-color: #6b7280; /* Darker grey for empty bar */
            border-radius: 6px; /* Smaller border-radius */
            overflow: hidden;
            margin-bottom: 0.6rem; /* Reduced margin */
            border: 1px solid #9ca3af;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3); /* Smaller shadow */
        }
        .resource-fill {
            height: 20px; /* Shorter bar */
            font-size: 0.9rem; /* Smaller font */
            text-shadow: 0 0 1px rgba(0,0,0,0.3); /* Lighter shadow */
        }
        .resource-controls {
            margin-top: 0.3rem; /* Reduced margin */
            gap: 0.3rem; /* Smaller gap */
        }
        .resource-controls button {
            padding: 0.3rem 0.6rem; /* Reduced padding */
            border-radius: 5px; /* Smaller border-radius */
            font-weight: 600; /* Slightly less bold */
            font-size: 0.75rem; /* Smaller font */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3); /* Smaller shadow */
        }

        /* Primary Buttons */
        .btn-primary {
            padding: 0.6rem 1.2rem; /* Reduced padding */
            border-radius: 8px; /* Slightly smaller radius */
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.8px; /* Slightly reduced letter spacing */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4); /* Smaller shadow */
            margin: 0.6rem auto; /* Reduced margin */
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        }

        /* Message Box */
        .message-box {
            padding: 0.6rem 1.2rem; /* Reduced padding */
            border: 1px solid #e0b000; /* Thinner border */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3); /* Smaller shadow */
        }

        /* Combat Section Specific Styles */
        .combat-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Adjust min-width for combat items */
            gap: 0.75rem; /* Reduced gap */
            /* margin-top: 1rem; Removed as section-block handles overall spacing */
        }
        .combat-item {
            padding: 0.8rem; /* Reduced padding */
        }
        .combat-item h3 {
            font-size: 1.1rem; /* Slightly smaller combat item titles */
            margin-top: 0.5rem; /* Reduced margin */
            margin-bottom: 0.4rem; /* Reduced margin */
        }
        .combat-item label {
            font-size: 0.75rem; /* Smaller labels within combat items */
        }
        .combat-item input[type="text"], .combat-item input[type="number"] {
            padding: 0.3rem; /* Reduced padding */
            font-size: 0.85rem; /* Smaller font */
        }
        .combat-item .input-group span {
            font-size: 0.85rem; /* Smaller percentage sign */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Caelum - Pulp Cthulhu Character Sheet</h1>

        <div class="message-box" id="messageBox"></div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 section-block"> <!-- Added section-block -->
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Name:</label>
                <input type="text" id="charName" value="Caelum" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Occupation:</label>
                <input type="text" id="charOccupation" value="Engineer" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Age:</label>
                <input type="number" id="charAge" value="28" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Archetype:</label>
                <input type="text" id="charArchetype" value="Grease Monkey" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 section-block"> <!-- Added section-block -->
            <!-- Left Column: Core Characteristics -->
            <div>
                <h2>Core Characteristics</h2>
                <div class="stat-grid">
                    <div class="stat-item">
                        <label for="str">STR (Strength)</label>
                        <input type="number" id="str" value="45" data-full="45" data-half="22" data-fifth="9">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="strHalf">22</span>, Fifth: <span id="strFifth">9</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="con">CON (Constitution)</label>
                        <input type="number" id="con" value="45" data-full="45" data-half="22" data-fifth="9">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="conHalf">22</span>, Fifth: <span id="conFifth">9</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="siz">SIZ (Size)</label>
                        <input type="number" id="siz" value="55" data-full="55" data-half="27" data-fifth="11">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="sizHalf">27</span>, Fifth: <span id="sizFifth">11</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="dex">DEX (Dexterity)</label>
                        <input type="number" id="dex" value="20" data-full="20" data-half="10" data-fifth="4">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="dexHalf">10</span>, Fifth: <span id="dexFifth">4</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="app">APP (Appearance)</label>
                        <input type="number" id="app" value="50" data-full="50" data-half="25" data-fifth="10">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="appHalf">25</span>, Fifth: <span id="appFifth">10</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="int">INT (Intelligence)</label>
                        <input type="number" id="int" value="90" data-full="90" data-half="45" data-fifth="18">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="intHalf">45</span>, Fifth: <span id="intFifth">18</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="pow">POW (Power)</label>
                        <input type="number" id="pow" value="35" data-full="35" data-half="17" data-fifth="7">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="powHalf">17</span>, Fifth: <span id="powFifth">7</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="edu">EDU (Education)</label>
                        <input type="number" id="edu" value="45" data-full="45" data-half="22" data-fifth="9">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="eduHalf">22</span>, Fifth: <span id="eduFifth">9</span></div>
                    </div>
                    <div class="stat-item">
                        <label for="luck">Luck</label>
                        <input type="number" id="luck" value="60" data-full="60" data-half="30" data-fifth="12">
                        <div class="text-xs text-gray-500 mt-2">Half: <span id="luckHalf">30</span>, Fifth: <span id="luckFifth">12</span></div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Resources -->
            <div>
                <h2>Resources</h2>
                <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hit Points (HP)</label>
                        <div class="resource-bar">
                            <div class="resource-fill" id="hpFill"></div>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <input type="number" id="currentHp" value="20" min="0" class="w-24 p-1 border rounded text-center">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="maxHp" value="20" min="1" class="w-24 p-1 border rounded text-center">
                        </div>
                        <div class="resource-controls">
                            <button class="btn-heal" onclick="adjustResource('hp', 1)">+1</button>
                            <button class="btn-heal" onclick="adjustResource('hp', 4)">+1D4</button>
                            <button class="btn-damage" onclick="adjustResource('hp', -1)">-1</button>
                            <button class="btn-damage" onclick="adjustResource('hp', -4)">-1D4</button>
                            <button class="btn-reset" onclick="resetResource('hp')">Reset</button>
                        </div>
                        <div class="mt-2 text-xs text-gray-500">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="majorWound" class="form-checkbox rounded">
                                <span class="ml-2">Major Wound</span>
                            </label>
                            <label class="inline-flex items-center ml-4">
                                <input type="checkbox" id="unconscious" class="form-checkbox rounded">
                                <span class="ml-2">Unconscious</span>
                            </label>
                            <label class="inline-flex items-center ml-4">
                                <input type="checkbox" id="dying" class="form-checkbox rounded">
                                <span class="ml-2">Dying</span>
                            </label>
                        </div>
                    </div>

                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Magic Points (MP)</label>
                        <div class="resource-bar">
                            <div class="resource-fill" id="mpFill"></div>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <input type="number" id="currentMp" value="7" min="0" class="w-24 p-1 border rounded text-center">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="maxMp" value="7" min="1" class="w-24 p-1 border rounded text-center">
                        </div>
                        <div class="resource-controls">
                            <button class="btn-heal" onclick="adjustResource('mp', 1)">+1</button>
                            <button class="btn-damage" onclick="adjustResource('mp', -1)">-1</button>
                            <button class="btn-reset" onclick="resetResource('mp')">Reset</button>
                        </div>
                    </div>

                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sanity (SAN)</label>
                        <div class="resource-bar">
                            <div class="resource-fill" id="sanFill"></div>
                        </div>
                        <div class="flex items-center justify-between mb-2">
                            <input type="number" id="currentSan" value="35" min="0" class="w-24 p-1 border rounded text-center">
                            <span class="text-gray-600">/</span>
                            <input type="number" id="maxSan" value="99" min="1" class="w-24 p-1 border rounded text-center">
                        </div>
                        <div class="resource-controls">
                            <button class="btn-heal" onclick="adjustResource('san', 1)">+1</button>
                            <button class="btn-damage" onclick="adjustResource('san', -1)">-1</button>
                            <button class="btn-reset" onclick="resetResource('san')">Reset</button>
                        </div>
                        <div class="mt-2 text-xs text-gray-500">
                            <label class="inline-flex items-center">
                                <input type="checkbox" id="tempInsanity" class="form-checkbox rounded">
                                <span class="ml-2">Temporary Insanity</span>
                            </label>
                            <label class="inline-flex items-center ml-4">
                                <input type="checkbox" id="indefiniteInsanity" class="form-checkbox rounded">
                                <span class="ml-2">Indefinite Insanity</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Skills section moved here to take full width -->
        <h2>Skills</h2>
        <div class="skill-grid section-block" id="skillGrid"> <!-- Added section-block -->
            <!-- Skills will be dynamically loaded here -->
        </div>

        <h2>Combat</h2>
        <div class="combat-section section-block"> <!-- Added section-block -->
            <div class="combat-item">
                <h3>Brawl</h3>
                <div class="input-group">
                    <label for="brawlSkill" class="sr-only">Skill %</label>
                    <input type="number" id="brawlSkill" value="50" class="w-full" placeholder="Skill %">
                    <span>%</span>
                </div>
                <label for="brawlDamage" class="sr-only">Damage</label>
                <input type="text" id="brawlDamage" value="1D3 + DB" class="w-full" placeholder="Damage">
                <label for="brawlAttacks" class="sr-only"># of Attacks</label>
                <input type="number" id="brawlAttacks" value="1" class="w-full mt-2" placeholder="# of Attacks">
            </div>
            <div class="combat-item">
                <h3>Dodge</h3>
                <div class="input-group">
                    <label for="dodgeSkill" class="sr-only">Skill %</label>
                    <input type="number" id="dodgeSkill" value="20" class="w-full" placeholder="Skill %">
                    <span>%</span>
                </div>
                <label for="move" class="sr-only">Move</label>
                <input type="number" id="move" value="7" class="w-full" placeholder="Move">
                <label for="build" class="sr-only">Build</label>
                <input type="text" id="build" value="O" class="w-full mt-2" placeholder="Build">
            </div>
            <div class="combat-item">
                <h3>Firearms (Handgun)</h3>
                <div class="input-group">
                    <label for="firearmsHandgunSkill" class="sr-only">Skill %</label>
                    <input type="number" id="firearmsHandgunSkill" value="20" class="w-full" placeholder="Skill %">
                    <span>%</span>
                </div>
                <label for="firearmsHandgunDamage" class="sr-only">Damage</label>
                <input type="text" id="firearmsHandgunDamage" value="1D10" class="w-full" placeholder="Damage (Example)">
                <label for="firearmsHandgunAttacks" class="sr-only"># of Attacks</label>
                <input type="number" id="firearmsHandgunAttacks" value="1" class="w-full mt-2" placeholder="# of Attacks">
            </div>
            <div class="combat-item">
                <h3>Firearms (Rifle/Shotgun)</h3>
                <div class="input-group">
                    <label for="firearmsRifleSkill" class="sr-only">Skill %</label>
                    <input type="number" id="firearmsRifleSkill" value="25" class="w-full" placeholder="Skill %">
                    <span>%</span>
                </div>
                <label for="firearmsRifleDamage" class="sr-only">Damage</label>
                <input type="text" id="firearmsRifleDamage" value="2D6" class="w-full" placeholder="Damage (Example)">
                <label for="firearmsRifleAttacks" class="sr-only"># of Attacks</label>
                <input type="number" id="firearmsRifleAttacks" value="1" class="w-full mt-2" placeholder="# of Attacks">
            </div>
        </div>


        <h2>Backstory & Possessions</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 section-block"> <!-- Added section-block -->
            <div>
                <h3>My Story</h3>
                <div class="section-content">
                    <textarea id="myStory" placeholder="Write your character's personal story here..."></textarea>
                </div>
            </div>
            <div>
                <h3>Backstory</h3>
                <div class="section-content">
                    <textarea id="backstory" placeholder="Details about Caelum's past..."></textarea>
                </div>
            </div>
            <div>
                <h3>Personal Description</h3>
                <div class="section-content">
                    <textarea id="personalDescription" placeholder="Describe Caelum's appearance..."></textarea>
                </div>
            </div>
            <div>
                <h3>Traits</h3>
                <div class="section-content">
                    <textarea id="traits" placeholder="List Caelum's personality traits..."></textarea>
                </div>
            </div>
            <div>
                <h3>Ideology & Beliefs</h3>
                <div class="section-content">
                    <textarea id="ideologyBeliefs" placeholder="What does Caelum believe in?"></textarea>
                </div>
            </div>
            <div>
                <h3>Injuries & Scars</h3>
                <div class="section-content">
                    <textarea id="injuriesScars" placeholder="Any notable injuries or scars?"></textarea>
                </div>
            </div>
            <div>
                <h3>Significant People</h3>
                <div class="section-content">
                    <textarea id="significantPeople" placeholder="Who are important people in Caelum's life?"></textarea>
                </div>
            </div>
            <div>
                <h3>Phobias & Manias</h3>
                <div class="section-content">
                    <textarea id="phobiasManias" placeholder="List Caelum's fears or obsessions..."></textarea>
                </div>
            </div>
            <div>
                <h3>Meaningful Locations</h3>
                <div class="section-content">
                    <textarea id="meaningfulLocations" placeholder="Places important to Caelum..."></textarea>
                </div>
            </div>
            <div>
                <h3>Treasured Possessions</h3>
                <div class="section-content">
                    <textarea id="treasuredPossessions" placeholder="What does Caelum value most?"></textarea>
                </div>
            </div>
            <div class="md:col-span-2">
                <h3>Gear & Possessions</h3>
                <div class="section-content">
                    <textarea id="gearPossessions" placeholder="List all of Caelum's equipment and items..."></textarea>
                </div>
            </div>
            <div class="md:col-span-2">
                <h3>Arcane Tomes & Spells</h3>
                <div class="section-content">
                    <textarea id="arcaneTomesSpells" placeholder="Any magical books or spells Caelum knows?"></textarea>
                </div>
            </div>
            <div class="md:col-span-2">
                <h3>Encounters with Strange Entities</h3>
                <div class="section-content">
                    <textarea id="strangeEntities" placeholder="Describe any encounters with otherworldly beings..."></textarea>
                </div>
            </div>
        </div>

        <h2>Wealth</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 section-block"> <!-- Added section-block -->
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Spending Level:</label>
                <input type="text" id="spendingLevel" value="$10.00" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Cash:</label>
                <input type="text" id="cash" value="$60.00" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
            <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                <label class="block text-sm font-medium text-gray-700">Assets:</label>
                <input type="text" id="assets" value="" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2">
            </div>
        </div>

        <button class="btn-primary" onclick="saveCharacter()">Save Character Data</button>
        <button class="btn-primary" onclick="loadCharacter()">Load Character Data</button>
    </div>

    <script type="module">
        // Helper function to show messages to the user
        function showMessage(message, type = "info") {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = message;
            messageBox.className = 'message-box show'; // Reset classes and show
            if (type === "error") {
                messageBox.style.backgroundColor = '#dc2626'; // Red for errors
            } else {
                messageBox.style.backgroundColor = '#f7d750'; // Gold for info
                messageBox.style.color = '#1f2937'; // Dark text on gold
            }
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        // Function to calculate half and fifth values for characteristics
        function calculateDerivedStats(value) {
            return {
                full: value,
                half: Math.floor(value / 2),
                fifth: Math.floor(value / 5)
            };
        }

        // Update displayed half and fifth values for a characteristic
        function updateCharacteristicDisplay(id) {
            const input = document.getElementById(id);
            const value = parseInt(input.value);
            const stats = calculateDerivedStats(value);
            document.getElementById(`${id}Half`).textContent = stats.half;
            document.getElementById(`${id}Fifth`).textContent = stats.fifth;
        }

        // Initial update for all characteristics on page load
        document.addEventListener('DOMContentLoaded', () => {
            const characteristics = ['str', 'con', 'siz', 'dex', 'app', 'int', 'pow', 'edu', 'luck'];
            characteristics.forEach(id => {
                updateCharacteristicDisplay(id);
            });
            updateResourceBar('hp');
            updateResourceBar('mp');
            updateResourceBar('san');
            // Call loadCharacter first, which will then call populateSkills
            loadCharacter();
        });

        // Add event listeners for characteristics to update on change
        const characteristicInputs = document.querySelectorAll('.stat-item input[type="number"]');
        characteristicInputs.forEach(input => {
            input.addEventListener('input', (event) => {
                updateCharacteristicDisplay(event.target.id);
            });
        });

        // Function to adjust HP, MP, SAN
        window.adjustResource = function(type, amount) {
            const currentInput = document.getElementById(`current${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const maxInput = document.getElementById(`max${type.charAt(0).toUpperCase() + type.slice(1)}`);

            let currentValue = parseInt(currentInput.value);
            const maxValue = parseInt(maxInput.value);

            let adjustedAmount = amount;
            if (amount.toString().includes('D')) { // Handle dice rolls like 1D4
                const [numDice, dieSize] = amount.toString().split('D').map(Number);
                adjustedAmount = 0;
                for (let i = 0; i < numDice; i++) {
                    adjustedAmount += Math.floor(Math.random() * dieSize) + 1;
                }
                showMessage(`Rolled ${adjustedAmount} for ${type}!`);
            }

            currentValue += adjustedAmount;

            // Clamp value between 0 and max
            currentValue = Math.max(0, Math.min(currentValue, maxValue));
            currentInput.value = currentValue;
            updateResourceBar(type);
        };

        // Function to reset HP, MP, SAN to max
        window.resetResource = function(type) {
            const currentInput = document.getElementById(`current${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const maxInput = document.getElementById(`max${type.charAt(0).toUpperCase() + type.slice(1)}`);
            currentInput.value = maxInput.value;
            updateResourceBar(type);
        };

        // Update resource bar visual
        function updateResourceBar(type) {
            const currentInput = document.getElementById(`current${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const maxInput = document.getElementById(`max${type.charAt(0).toUpperCase() + type.slice(1)}`);
            const fillElement = document.getElementById(`${type}Fill`);

            const currentValue = parseInt(currentInput.value);
            const maxValue = parseInt(maxInput.value);

            if (maxValue > 0) {
                const percentage = (currentValue / maxValue) * 100;
                fillElement.style.width = `${percentage}%`;
                fillElement.textContent = `${currentValue}/${maxValue}`;
            } else {
                fillElement.style.width = '0%';
                fillElement.textContent = `0/0`;
            }

            // Change color based on percentage for HP only
            if (type === 'hp') {
                if (currentValue / maxValue <= 0.25) {
                    fillElement.style.backgroundColor = '#ef4444'; /* Red */
                } else if (currentValue / maxValue <= 0.5) {
                    fillElement.style.backgroundColor = '#f59e0b'; /* Amber */
                } else {
                    fillElement.style.backgroundColor = '#22c55e'; /* Green */
                }
            }
        }

        // Add event listeners for resource inputs to update on change
        document.getElementById('currentHp').addEventListener('input', () => updateResourceBar('hp'));
        document.getElementById('maxHp').addEventListener('input', () => updateResourceBar('hp'));
        document.getElementById('currentMp').addEventListener('input', () => updateResourceBar('mp'));
        document.getElementById('maxMp').addEventListener('input', () => updateResourceBar('mp'));
        document.getElementById('currentSan').addEventListener('input', () => updateResourceBar('san'));
        document.getElementById('maxSan').addEventListener('input', () => updateResourceBar('san'));


        // Define skills data based on the PDF
        const skillsData = [
            { name: "Accounting", value: 5, checked: false },
            { name: "Appraise", value: 5, checked: false },
            { name: "Archaeology", value: 1, checked: false },
            { name: "Art/Craft", value: 5, checked: false }, // Placeholder, needs specific craft
            { name: "Charm", value: 15, checked: false },
            { name: "Chemistry", value: 1, checked: false },
            { name: "Climb", value: 20, checked: false },
            { name: "Computer Use", value: 0, checked: false },
            { name: "Credit Rating", value: 0, checked: false },
            { name: "Cthulhu Mythos", value: 0, checked: false },
            { name: "Demolitions", value: 1, checked: false },
            { name: "Disguise", value: 5, checked: false },
            { name: "Diving", value: 1, checked: false },
            { name: "Dodge", value: 20, checked: false }, // Special: half DEX
            { name: "Drive Auto", value: 20, checked: false },
            { name: "Elec. Repair", value: 10, checked: false },
            { name: "Fast Talk", value: 5, checked: false },
            { name: "Fighting (Brawl)", value: 25, checked: false },
            { name: "Firearms (Handgun)", value: 20, checked: false },
            { name: "Firearms (Rifle/Shotgun)", value: 25, checked: false },
            { name: "First Aid", value: 30, checked: false },
            { name: "Garrote", value: 5, checked: false },
            { name: "History", value: 5, checked: false },
            { name: "Intimidate", value: 15, checked: false },
            { name: "Jump", value: 20, checked: false },
            { name: "Language (Own - English)", value: 45, checked: false },
            { name: "Language (Other)", value: 1, checked: false }, // Placeholder
            { name: "Law", value: 5, checked: false },
            { name: "Library Use", value: 20, checked: false },
            { name: "Listen", value: 20, checked: false },
            { name: "Locksmith", value: 1, checked: false },
            { name: "Mech. Repair", value: 10, checked: false },
            { name: "Medicine", value: 1, checked: false },
            { name: "Natural World", value: 10, checked: false },
            { name: "Navigate", value: 10, checked: false },
            { name: "Occult", value: 5, checked: false },
            { name: "Persuade", value: 10, checked: false },
            { name: "Pilot", value: 1, checked: false }, // Placeholder, needs specific vehicle
            { name: "Psychoanalysis", value: 1, checked: false },
            { name: "Psychology", value: 10, checked: false },
            { name: "Read Lips", value: 1, checked: false },
            { name: "Ride", value: 5, checked: false },
            { name: "Science (Physics)", value: 1, checked: false }, // Placeholder, needs specific science
            { name: "Sleight of Hand", value: 10, checked: false },
            { name: "Spot Hidden", value: 25, checked: false },
            { name: "Stealth", value: 20, checked: false },
            { name: "Survival", value: 10, checked: false }, // Placeholder
            { name: "Swim", value: 20, checked: false },
            { name: "Technical Drawing", value: 5, checked: false },
            { name: "Throw", value: 20, checked: false },
            { name: "Track", value: 10, checked: false }
        ];

        // Function to populate skills dynamically
        function populateSkills() {
            const skillGrid = document.getElementById('skillGrid');
            if (!skillGrid) {
                console.error("Error: skillGrid element not found. Cannot populate skills.");
                return; // Exit if element is null
            }
            skillGrid.innerHTML = ''; // Clear existing skills
            skillsData.forEach((skill, index) => {
                const skillItem = document.createElement('div');
                skillItem.className = 'skill-item';
                skillItem.innerHTML = `
                    <label for="skill-${index}">${skill.name}</label>
                    <div class="skill-value-group">
                        <input type="number" id="skill-${index}" value="${skill.value}" min="0">
                        <span>%</span>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="skill-checked-${index}" ${skill.checked ? 'checked' : ''}>
                        <span>Trained</span>
                    </div>
                `;
                skillGrid.appendChild(skillItem);

                // Add event listener to update skill data when input changes
                const skillInput = skillItem.querySelector(`#skill-${index}`);
                skillInput.addEventListener('input', (event) => {
                    skillsData[index].value = parseInt(event.target.value);
                });
                const skillCheckbox = skillItem.querySelector(`#skill-checked-${index}`);
                skillCheckbox.addEventListener('change', (event) => {
                    skillsData[index].checked = event.target.checked;
                });
            });
        }

        // Function to save character data to Local Storage
        window.saveCharacter = function() {
            // Collect all data from the form
            const characterData = {
                // Basic Info
                name: document.getElementById('charName').value,
                occupation: document.getElementById('charOccupation').value,
                age: parseInt(document.getElementById('charAge').value),
                archetype: document.getElementById('charArchetype').value,

                // Characteristics
                characteristics: {
                    str: parseInt(document.getElementById('str').value),
                    con: parseInt(document.getElementById('con').value),
                    siz: parseInt(document.getElementById('siz').value),
                    dex: parseInt(document.getElementById('dex').value),
                    app: parseInt(document.getElementById('app').value),
                    int: parseInt(document.getElementById('int').value),
                    pow: parseInt(document.getElementById('pow').value),
                    edu: parseInt(document.getElementById('edu').value),
                    luck: parseInt(document.getElementById('luck').value),
                },

                // Resources
                resources: {
                    hp: {
                        current: parseInt(document.getElementById('currentHp').value),
                        max: parseInt(document.getElementById('maxHp').value),
                        majorWound: document.getElementById('majorWound').checked,
                        unconscious: document.getElementById('unconscious').checked,
                        dying: document.getElementById('dying').checked,
                    },
                    mp: {
                        current: parseInt(document.getElementById('currentMp').value),
                        max: parseInt(document.getElementById('maxMp').value),
                    },
                    san: {
                        current: parseInt(document.getElementById('currentSan').value),
                        max: parseInt(document.getElementById('maxSan').value),
                        tempInsanity: document.getElementById('tempInsanity').checked,
                        indefiniteInsanity: document.getElementById('indefiniteInsanity').checked,
                    },
                },

                // Skills (using the skillsData array)
                skills: skillsData,

                // Combat
                combat: {
                    brawl: {
                        skill: parseInt(document.getElementById('brawlSkill').value),
                        damage: document.getElementById('brawlDamage').value,
                        attacks: parseInt(document.getElementById('brawlAttacks').value),
                    },
                    dodge: {
                        skill: parseInt(document.getElementById('dodgeSkill').value),
                        move: parseInt(document.getElementById('move').value),
                        build: document.getElementById('build').value,
                    },
                    firearmsHandgun: {
                        skill: parseInt(document.getElementById('firearmsHandgunSkill').value),
                        damage: document.getElementById('firearmsHandgunDamage').value,
                        attacks: parseInt(document.getElementById('firearmsHandgunAttacks').value),
                    },
                    firearmsRifle: {
                        skill: parseInt(document.getElementById('firearmsRifleSkill').value),
                        damage: document.getElementById('firearmsRifleDamage').value,
                        attacks: parseInt(document.getElementById('firearmsRifleAttacks').value),
                    },
                },

                // Backstory & Possessions
                backstoryDetails: {
                    myStory: document.getElementById('myStory').value,
                    backstory: document.getElementById('backstory').value,
                    personalDescription: document.getElementById('personalDescription').value,
                    traits: document.getElementById('traits').value,
                    ideologyBeliefs: document.getElementById('ideologyBeliefs').value,
                    injuriesScars: document.getElementById('injuriesScars').value,
                    significantPeople: document.getElementById('significantPeople').value,
                    phobiasManias: document.getElementById('phobiasManias').value,
                    meaningfulLocations: document.getElementById('meaningfulLocations').value,
                    treasuredPossessions: document.getElementById('treasuredPossessions').value,
                    gearPossessions: document.getElementById('gearPossessions').value,
                    arcaneTomesSpells: document.getElementById('arcaneTomesSpells').value,
                    strangeEntities: document.getElementById('strangeEntities').value,
                },

                // Wealth
                wealth: {
                    spendingLevel: document.getElementById('spendingLevel').value,
                    cash: document.getElementById('cash').value,
                    assets: document.getElementById('assets').value,
                }
            };

            try {
                // Save to local storage
                localStorage.setItem('caelumCharacterData', JSON.stringify(characterData));
                showMessage("Character data saved successfully to your browser!");
                console.log("Character data saved to local storage.");
            } catch (e) {
                console.error("Error saving character data to local storage: ", e);
                showMessage("Error saving character data: " + e.message, "error");
            }
        };

        // Function to load character data from Local Storage
        window.loadCharacter = function() {
            try {
                // Load from local storage
                const storedData = localStorage.getItem('caelumCharacterData');

                if (storedData) {
                    const data = JSON.parse(storedData);
                    console.log("Character data loaded from local storage:", data);

                    // Populate basic info
                    document.getElementById('charName').value = data.name || '';
                    document.getElementById('charOccupation').value = data.occupation || '';
                    document.getElementById('charAge').value = data.age || '';
                    document.getElementById('charArchetype').value = data.archetype || '';

                    // Populate characteristics
                    for (const stat in data.characteristics) {
                        const input = document.getElementById(stat);
                        if (input) {
                            input.value = data.characteristics[stat];
                            updateCharacteristicDisplay(stat);
                        }
                    }

                    // Populate resources
                    document.getElementById('currentHp').value = data.resources.hp.current;
                    document.getElementById('maxHp').value = data.resources.hp.max;
                    document.getElementById('majorWound').checked = data.resources.hp.majorWound;
                    document.getElementById('unconscious').checked = data.resources.hp.unconscious;
                    document.getElementById('dying').checked = data.resources.hp.dying;
                    updateResourceBar('hp');

                    document.getElementById('currentMp').value = data.resources.mp.current;
                    document.getElementById('maxMp').value = data.resources.mp.max;
                    updateResourceBar('mp');

                    document.getElementById('currentSan').value = data.resources.san.current;
                    document.getElementById('maxSan').value = data.resources.san.max;
                    document.getElementById('tempInsanity').checked = data.resources.san.tempInsanity;
                    document.getElementById('indefiniteInsanity').checked = data.resources.san.indefiniteInsanity;
                    updateResourceBar('san');

                    // Populate skills
                    if (data.skills && data.skills.length > 0) {
                        // Update the global skillsData array with loaded values
                        data.skills.forEach((loadedSkill, index) => {
                            if (skillsData[index]) { // Ensure the skill exists in our default list
                                skillsData[index].value = loadedSkill.value;
                                skillsData[index].checked = loadedSkill.checked;
                            }
                        });
                    }
                    populateSkills(); // Call populateSkills after data is loaded/updated

                    // Populate combat
                    document.getElementById('brawlSkill').value = data.combat.brawl.skill || '';
                    document.getElementById('brawlDamage').value = data.combat.brawl.damage || '';
                    document.getElementById('brawlAttacks').value = data.combat.brawl.attacks || '';

                    document.getElementById('dodgeSkill').value = data.combat.dodge.skill || '';
                    document.getElementById('move').value = data.combat.dodge.move || '';
                    document.getElementById('build').value = data.combat.dodge.build || '';

                    document.getElementById('firearmsHandgunSkill').value = data.combat.firearmsHandgun.skill || '';
                    document.getElementById('firearmsHandgunDamage').value = data.combat.firearmsHandgun.damage || '';
                    document.getElementById('firearmsHandgunAttacks').value = data.combat.firearmsHandgun.attacks || '';

                    document.getElementById('firearmsRifleSkill').value = data.combat.firearmsRifle.skill || '';
                    document.getElementById('firearmsRifleDamage').value = data.combat.firearmsRifle.damage || '';
                    document.getElementById('firearmsRifleAttacks').value = data.combat.firearmsRifle.attacks || '';


                    // Populate backstory & possessions
                    document.getElementById('myStory').value = data.backstoryDetails.myStory || '';
                    document.getElementById('backstory').value = data.backstoryDetails.backstory || '';
                    document.getElementById('personalDescription').value = data.backstoryDetails.personalDescription || '';
                    document.getElementById('traits').value = data.backstoryDetails.traits || '';
                    document.getElementById('ideologyBeliefs').value = data.ideologyBeliefs || '';
                    document.getElementById('injuriesScars').value = data.injuriesScars || '';
                    document.getElementById('significantPeople').value = data.significantPeople || '';
                    document.getElementById('phobiasManias').value = data.phobiasManias || '';
                    document.getElementById('meaningfulLocations').value = data.meaningfulLocations || '';
                    document.getElementById('treasuredPossessions').value = data.treasuredPossessions || '';
                    document.getElementById('gearPossessions').value = data.gearPossessions || '';
                    document.getElementById('arcaneTomesSpells').value = data.arcaneTomesSpells || '';
                    document.getElementById('strangeEntities').value = data.strangeEntities || '';

                    // Populate wealth
                    document.getElementById('spendingLevel').value = data.wealth.spendingLevel || '';
                    document.getElementById('cash').value = data.wealth.cash || '';
                    document.getElementById('assets').value = data.wealth.assets || '';

                    showMessage("Character data loaded successfully from your browser!");
                } else {
                    showMessage("No saved character data found in your browser. Starting fresh.", "info");
                    console.log("No character data found in local storage.");
                    populateSkills(); // Populate with default skills if no saved data
                }
            } catch (e) {
                console.error("Error loading character data from local storage: ", e);
                showMessage("Error loading character data: " + e.message, "error");
            }
        };
    </script>
</body>
</html>
